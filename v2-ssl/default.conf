server {
    listen *:80;
    listen [::]:80;
    server_name nginx.hamidfiroozian.dev;

    # Redirect HTTP to HTTPS
    return 301 https://$host$request_uri;
}

server {
    listen *:443 ssl http2;
    listen [::]:443 ssl http2;
    server_name nginx.hamidfiroozian.dev;

    ssl_certificate /etc/nginx/certs/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3; # Use compatible SSL protocols
    ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH'; # Specify compatible SSL cipher suite
    # add_header Strict-Transport-Security "max-age=31536000" always;
    # proxy_set_header Upgrade $http_upgrade;
    # proxy_set_header Host $host;
    # proxy_cache_bypass $http_upgrade;
    # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # _had to include this line_
    # proxy_set_header X-Forwarded-Proto $scheme; # _also included this line_

    location / {
        # proxy_pass https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT;
        # proxy_pass https://api.coingecko.com/api/v3/coins/bsc/contract/0xbb4CdB9CBd36B01bD1cBaEBF2De08d9173bc095c;
        proxy_pass https://sepolia.infura.io/v3/88c480d89d7042fd84bcdbdebcaadcef;

        # Add headers to simulate browser request
        # proxy_set_header User-Agent "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36";
        # proxy_set_header Accept-Encoding "gzip, deflate, br";
        # proxy_set_header Accept-Language "en-US,en;q=0.9";
        # proxy_set_header Accept "*/*";
        # proxy_set_header Connection "keep-alive";
        # proxy_set_header Referer "https://nginx.hamidfiroozian.dev/";
        # proxy_set_header Upgrade-Insecure-Requests "1";
        # proxy_set_header Cache-Control "max-age=0";

        # Set all request headers to pass to the proxied server
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Set all other headers from the client's request
        proxy_set_header Accept $http_accept;
        proxy_set_header Accept-Encoding $http_accept_encoding;
        proxy_set_header Accept-Language $http_accept_language;
        proxy_set_header Cache-Control $http_cache_control;
        proxy_set_header Content-Length $http_content_length;
        proxy_set_header Content-Type $http_content_type;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Referer $http_referer;
        proxy_set_header User-Agent $http_user_agent;

        # You can add more headers if needed
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_read_timeout 900s;  # Increase timeout if needed
    }
}